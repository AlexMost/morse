/* Copyright (c) Microsoft Open Technologies, Inc. All rights reserved. See License.txt in the project root for license information.*/
(function(a){var b={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},c=b[typeof window]&&window||this,d=b[typeof exports]&&exports&&!exports.nodeType&&exports,e=b[typeof module]&&module&&!module.nodeType&&module,f=(e&&e.exports===d&&d,b[typeof global]&&global);!f||f.global!==f&&f.window!==f||(c=f),"function"==typeof define&&define.amd?define(["rx","exports"],function(b,d){return c.Rx=a(c,d,b),c.Rx}):"object"==typeof module&&module&&module.exports===d?module.exports=a(c,module.exports,require("rx")):c.Rx=a(c,{},c.Rx)}).call(this,function(a,b,c,d){function e(a,b,c,d){if(a.addEventListener)return a.addEventListener(b,c,d),n(function(){a.removeEventListener(b,c,d)});throw new Error("No listener found")}function f(a,b,c,d){var g=new o,h=Object.prototype.toString;if("[object NodeList]"===h.call(a)||"[object HTMLCollection]"===h.call(a))for(var i=0,j=a.length;j>i;i++)g.add(f(a.item(i),b,c,d));else a&&g.add(e(a,b,c,d));return g}function g(){if(a.XMLHttpRequest)return new a.XMLHttpRequest;var b;try{for(var c=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],d=0;3>d;d++)try{if(b=c[d],new a.ActiveXObject(b))break}catch(e){}return new a.ActiveXObject(b)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}function h(){var b=new a.XMLHttpRequest;if("withCredentials"in b)return b;if(a.XDomainRequest)return new XDomainRequest;throw new Error("CORS is not supported by your browser")}function i(a,b,c){var d="response"in b?b.response:b.responseText;return d="json"===c.responseType?JSON.parse(d):d,{response:d,status:b.status,responseType:b.responseType,xhr:b,originalEvent:a}}function j(a,b,c){return{type:c,status:b.status,xhr:b,originalEvent:a}}var k=c.Observable,l=(k.prototype,c.AnonymousObservable),m=c.Observer.create,n=c.Disposable.create,o=c.CompositeDisposable,p=c.SingleAssignmentDisposable,q=c.AsyncSubject,r=c.Subject,s=c.Scheduler,t=function(){return Date.now?Date.now:function(){return+new Date}}(),u=c.DOM={},v={}.hasOwnProperty,w=(c.helpers.noop,c.helpers.isFunction),x=u.fromEvent=function(a,b,c,d){var e=w(c)?c:null;return"boolean"==typeof c&&(d=c),"undefined"==typeof d&&(d=!1),new l(function(c){return f(a,b,function(){var a=arguments[0];if(e){var a=tryCatch(e).apply(null,arguments);if(a===errorObj)return c.onError(a.e)}c.onNext(a)},d)}).publish().refCount()};!function(){var b="blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu";a.PointerEvent&&(b+=" pointerdown pointerup pointermove pointerover pointerout pointerenter pointerleave"),a.TouchEvent&&(b+=" touchstart touchend touchmove touchcancel"),b=b.split(" ");for(var c=0,d=b.length;d>c;c++)!function(a){u[a]=function(b,c,d){return x(b,a,c,d)}}(b[c])}(),u.ready=function(){return new l(function(b){function c(){b.onNext(),b.onCompleted()}var d=!1;return"complete"===document.readyState?setTimeout(c,0):(d=!0,document.addEventListener("DOMContentLoaded",c,!1),a.addEventListener("load",c,!1)),function(){d&&(document.removeEventListener("DOMContentLoaded",c,!1),a.removeEventListener("load",c,!1))}})};var y=u.ajax=function(b){var c={method:"GET",crossDomain:!1,contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,headers:{},responseType:"text"};if("string"==typeof b)c.url=b;else for(var e in b)v.call(b,e)&&(c[e]=b[e]);return c.crossDomain||c.headers["X-Requested-With"]||(c.headers["X-Requested-With"]="XMLHttpRequest"),c.hasContent=c.body!==d,new l(function(b){var d=!1;try{var e=c.crossDomain?h():g()}catch(f){b.onError(f)}try{c.user?e.open(c.method,c.url,c.async,c.user,c.password):e.open(c.method,c.url,c.async);var k=c.headers;for(var l in k)v.call(k,l)&&e.setRequestHeader(l,k[l]);e.upload||!("withCredentials"in e)&&a.XDomainRequest?(e.onload=function(a){c.progressObserver&&(c.progressObserver.onNext(a),c.progressObserver.onCompleted()),b.onNext(i(a,e,c)),b.onCompleted(),d=!0},c.progressObserver&&(e.onprogress=function(a){c.progressObserver.onNext(a)}),e.onerror=function(a){c.progressObserver&&c.progressObserver.onError(a),b.onError(j(a,e,"error")),d=!0},e.onabort=function(a){c.progressObserver&&c.progressObserver.onError(a),b.onError(j(a,e,"abort")),d=!0}):e.onreadystatechange=function(a){if(4===e.readyState){var f=1223==e.status?204:e.status;f>=200&&300>=f||0===f||""===f?(b.onNext(i(a,e,c)),b.onCompleted()):b.onError(j(a,e,"error")),d=!0}},e.send(c.hasContent&&c.body||null)}catch(m){b.onError(m)}return function(){d||4===e.readyState||e.abort()}})};u.post=function(a,b){return y({url:a,body:b,method:"POST"})};u.get=function(a){return y({url:a})};u.getJSON=function(b){if(!a.JSON&&"function"!=typeof a.JSON.parse)throw new TypeError("JSON is not supported in your runtime.");return y({url:b,responseType:"json"}).map(function(a){return a.response})};var z=function(){var a=document.createElement("div");return function(b){a.appendChild(b),a.innerHTML=""}}();u.jsonpRequest=function(){var b=0;return function(c){return new l(function(d){var e="callback_"+(b++).toString(36),f={jsonp:"JSONPCallback",async:!0,jsonpCallback:"rxjsjsonpCallbacks"+e};if("string"==typeof c)f.url=c;else for(var g in c)v.call(c,g)&&(f[g]=c[g]);var h=document.createElement("script");h.type="text/javascript",h.async=f.async,h.src=f.url.replace(f.jsonp,f.jsonpCallback),a[f.jsonpCallback]=function(b){a[f.jsonpCallback].called=!0,a[f.jsonpCallback].data=b};var i=function(b){"load"!==b.type||a[f.jsonpCallback].called||(b={type:"error"});var c="error"===b.type?400:200,e=a[f.jsonpCallback].data;200===c?(d.onNext({status:c,responseType:"jsonp",response:e,originalEvent:b}),d.onCompleted()):d.onError({type:"error",status:c,originalEvent:b})};h.onload=h.onreadystatechanged=h.onerror=i;var j=document.getElementsByTagName("head")[0]||document.documentElement;return j.insertBefore(h,j.firstChild),function(){h.onload=h.onreadystatechanged=h.onerror=null,z(h),h=null}})}}(),u.fromWebSocket=function(a,b,c,d){function e(a,b){f&&(d&&(d.onNext(),d.onCompleted()),a?f.close(a,b):f.close())}if(!WebSocket)throw new TypeError("WebSocket not implemented in your runtime.");var f,g=new l(function(d){function g(a){c.onNext(a),c.onCompleted(),f.removeEventListener("open",g,!1)}function h(a){d.onNext(a)}function i(a){d.onError(a)}function j(a){return 1e3===a.code&&a.wasClean?void d.onCompleted():d.onError(a)}return f=b?new WebSocket(a,b):new WebSocket(a),c&&f.addEventListener("open",g,!1),f.addEventListener("message",h,!1),f.addEventListener("error",i,!1),f.addEventListener("close",j,!1),function(){e(),f.removeEventListener("message",h,!1),f.removeEventListener("error",i,!1),f.removeEventListener("close",j,!1)}}),h=m(function(a){f&&f.readyState===WebSocket.OPEN&&f.send(a)},function(a){if(!a.code)throw new Error('no code specified. be sure to pass { code: ###, reason: "" } to onError()');e(a.code,a.reason||"")},function(){e(1e3,"")});return r.create(h,g)},u.fromWebWorker=function(b){if(!a.Worker)throw new TypeError("Worker not implemented in your runtime.");var c=new a.Worker(b),d=new l(function(a){function b(b){a.onNext(b)}function d(b){a.onError(b)}return c.addEventListener("message",b,!1),c.addEventListener("error",d,!1),function(){c.close(),c.removeEventListener("message",b,!1),c.removeEventListener("error",d,!1)}}),e=m(function(a){c.postMessage(a)});return r.create(e,d)},u.fromEventSource=function(b,c){if(!a.EventSource)throw new TypeError("EventSource not implemented in your runtime.");return new l(function(d){function e(a){c.onNext(a),c.onCompleted(),h.removeEventListener("open",e,!1)}function f(a){a.readyState===EventSource.CLOSED?d.onCompleted():d.onError(a)}function g(a){d.onNext(a)}var h=new a.EventSource(b);return c&&h.addEventListener("open",e,!1),h.addEventListener("error",f,!1),h.addEventListener("message",g,!1),function(){h.removeEventListener("error",f,!1),h.removeEventListener("message",g,!1),h.close()}})},u.fromMutationObserver=function(b,c){var d=a.MutationObserver||a.WebKitMutationObserver;if(!d)throw new TypeError("MutationObserver not implemented in your runtime.");return observableCreate(function(a){var e=new d(a.onNext.bind(a));return e.observe(b,c),e.disconnect.bind(e)})};var A,B;return a.requestAnimationFrame?(A=a.requestAnimationFrame,B=a.cancelAnimationFrame):a.mozRequestAnimationFrame?(A=a.mozRequestAnimationFrame,B=a.mozCancelAnimationFrame):a.webkitRequestAnimationFrame?(A=a.webkitRequestAnimationFrame,B=a.webkitCancelAnimationFrame):a.msRequestAnimationFrame?(A=a.msRequestAnimationFrame,B=a.msCancelAnimationFrame):a.oRequestAnimationFrame?(A=a.oRequestAnimationFrame,B=a.oCancelAnimationFrame):(A=function(b){a.setTimeout(b,1e3/60)},B=a.clearTimeout),s.requestAnimationFrame=function(){function b(a,b){var c=this,d=new p,e=A(function(){!d.isDisposed&&d.setDisposable(b(c,a))});return new o(d,n(function(){B(e)}))}function c(b,c,d){var e=this,f=s.normalize(c);if(0===f)return e.scheduleWithState(b,d);var g=new p,h=a.setTimeout(function(){g.isDisposed||g.setDisposable(d(e,b))},f);return new o(g,n(function(){a.clearTimeout(h)}))}function d(a,b,c){return this.scheduleWithRelativeAndState(a,b-this.now(),c)}return new s(t,b,c,d)}(),s.microtask=function(){function b(a){delete k[a]}function c(d){if(l)a.setTimeout(function(){c(d)},0);else{var e=k[d];if(e){l=!0;try{e()}catch(f){throw f}finally{b(d),l=!1}}}}function d(){if(!a.postMessage||a.importScripts)return!1;var b=!1,c=a.onmessage;return a.onmessage=function(){b=!0},a.postMessage("","*"),a.onmessage=c,b}function e(a){"string"==typeof a.data&&a.data.substring(0,v.length)===v&&c(a.data.substring(v.length))}function f(a,c){var d=this,e=new p,f=i(function(){!e.isDisposed&&e.setDisposable(c(d,a))});return new o(e,n(function(){b(f)}))}function g(b,c,d){var e=this,f=s.normalize(c);if(0===f)return e.scheduleWithState(b,d);var g=new p,h=a.setTimeout(function(){g.isDisposed||g.setDisposable(d(e,b))},f);return new o(g,n(function(){a.clearTimeout(h)}))}function h(a,b,c){return this.scheduleWithRelativeAndState(a,b-this.now(),c)}var i,j=1,k={},l=!1,m=a.MutationObserver||a.WebKitMutationObserver;if(m){var q="drainqueue_",r=new m(function(a){a.forEach(function(a){c(a.attributeName.substring(q.length))})}),u=document.createElement("div");r.observe(u,{attributes:!0}),a.addEventListener("unload",function(){r.disconnect(),r=null},!1),i=function(a){var b=j++;return k[b]=a,u.setAttribute(q+b,"drainQueue"),b}}else if("function"==typeof a.setImmediate)i=function(b){var d=j++;return k[d]=b,a.setImmediate(function(){c(d)}),d};else if(d()){var v="ms.rx.schedule"+Math.random();a.addEventListener?a.addEventListener("message",e,!1):a.attachEvent&&a.attachEvent("onmessage",e),i=function(b){var c=j++;return k[currentId]=b,a.postMessage(v+currentId,"*"),c}}else if(a.MessageChannel){var w=new a.MessageChannel;w.port1.onmessage=function(a){c(a.data)},i=function(a){var b=j++;return k[b]=a,w.port2.postMessage(b),b}}else i="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(b){var d=a.document.createElement("script"),e=j++;return k[e]=b,d.onreadystatechange=function(){c(e),d.onreadystatechange=null,d.parentNode.removeChild(d),d=null},a.document.documentElement.appendChild(d),e}:function(b){var d=j++;return k[d]=b,a.setTimeout(function(){c(d)},0),d};return new s(t,f,g,h)}(),c.DOM.geolocation={getCurrentPosition:function(b){if(!a.navigator&&!a.navigation.geolocation)throw new TypeError("geolocation not available");return new l(function(c){a.navigator.geolocation.getCurrentPosition(function(a){c.onNext(a),c.onCompleted()},c.onError.bind(c),b)})},watchPosition:function(b){if(!a.navigator&&!a.navigation.geolocation)throw new TypeError("geolocation not available");return new l(function(c){var d=a.navigator.geolocation.watchPosition(c.onNext.bind(c),c.onError.bind(c),b);return function(){a.navigator.geolocation.clearWatch(d)}}).publish().refCount()}},u.fromReader=function(b,c){function d(b,d,e){return new l(function(f){function g(a){c&&c.onCompleted(),k.onNext(a.target.result),k.onCompleted()}function h(a){k.onError(a.target.error)}function i(a){c.onNext(a)}var j=new a.FileReader,k=new q;return j.addEventListener("load",g,!1),j.addEventListener("error",h,!1),c&&j.addEventListener("progress",i,!1),j[b](d,e),new o(k.subscribe(f),n(function(){j.readyState==a.FileReader.LOADING&&j.abort(),j.removeEventListener("load",g,!1),j.removeEventListener("error",h,!1),c&&j.removeEventListener("progress",i,!1)}))})}if(!a.FileReader)throw new TypeError("FileReader not implemented in your runtime.");return{asArrayBuffer:function(){return d("readAsArrayBuffer",b)},asBinaryString:function(){return d("readAsBinaryString",b)},asDataURL:function(){return d("readAsDataURL",b)},asText:function(a){return d("readAsText",b,a)}}},c});
//# sourceMappingURL=rx.dom.map